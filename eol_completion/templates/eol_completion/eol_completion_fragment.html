## mako
<%! from django.utils.translation import ugettext as _ %>
<%namespace name='static' file='/static_content.html'/>
<%inherit file="/main.html" />
<%block name="bodyclass">view-new_tab_type is-in-course course</%block>
<%block name="pagetitle">${_("PAGE NAME")}</%block>
<%block name="headextra">

<link rel="stylesheet" type="text/css" href="${static.url('eol_completion/DataTables-1.10.20/css/jquery.dataTables.min.css')}"/> 
<link rel="stylesheet" type="text/css" href="${static.url('eol_completion/Responsive-2.2.3/css/responsive.dataTables.min.css')}"/> 
<link rel="stylesheet" type="text/css" href="${static.url('eol_completion/Buttons-1.6.1/css/buttons.dataTables.min.css')}"/> 

<script type="text/javascript" src="${static.url('eol_completion/jQuery-3.3.1/jquery-3.3.1.js')}"></script>
<script type="text/javascript" src="${static.url('eol_completion/DataTables-1.10.20/js/jquery.dataTables.min.js')}"></script> 
<script type="text/javascript" src="${static.url('eol_completion/Responsive-2.2.3/js/dataTables.responsive.min.js')}"></script>    
<script type="text/javascript" src="${static.url('eol_completion/Buttons-1.6.1/js/dataTables.buttons.min.js')}"></script>      
<script type="text/javascript" src="${static.url('eol_completion/Buttons-1.6.1/js/buttons.colVis.min.js')}"></script>
<script type="text/javascript" src="${static.url('eol_completion/Buttons-1.6.1/js/buttons.flash.min.js')}"></script>  
<script type="text/javascript" src="${static.url('eol_completion/Buttons-1.6.1/js/buttons.html5.min.js')}"></script> 
<script type="text/javascript" src="${static.url('eol_completion/JSZip-2.5.0/jszip.min.js')}"></script>  
<script type="text/javascript" src="${static.url('eol_completion/pdfmake-0.1.36/pdfmake.min.js')}"></script>  
<script type="text/javascript" src="${static.url('eol_completion/pdfmake-0.1.36/vfs_fonts.js')}"></script>     
<script type="text/javascript" src="${static.url('eol_completion/Buttons-1.6.1/js/buttons.print.min.js')}"></script>
<!--script type="text/javascript" src="${static.url('eol_completion/js/eol_completion.js')}"></!--script--> 
<%static:css group='style-course'/>
</%block>
<%include file="/courseware/course_navigation.html" args="active_page='PAGE-SLUG'" />
<style>
    div.dataTables_wrapper {           
            margin: 0 auto;
        }

    th, td {
        border-top: 1px solid #dddddd;
        border-bottom: 1px solid #dddddd;
        border-right: 1px solid #dddddd;
    }
    
    th:first-child {
        border-left: 1px solid #dddddd;
    }
    a.novisto {
        background-color: #55c0ff;
        box-shadow: 0 2px 0 #efd9d9;
        color: black;
        padding: 0em 0.5em;
        position: relative;
        text-decoration: none;
    }

    a.visto {
        background-color: #fbeeee;
        box-shadow: 0 2px 0 #efd9d9;
        color: black;
        padding: 0em 0.5em;
        position: relative;
        text-decoration: none;
    }
    a.visto:hover {
        background-color: #55c0ff;
        cursor: pointer;
    }
    a.novisto:hover {
        background-color: #fbeeee;
        cursor: pointer;
    }
    a.novisto:active {
        box-shadow: none;
        top: 2px;
    }
</style>
<div class="container">
    <div class="teams-wrapper">
        <main id="main" aria-label="Content" tabindex="-1">
            <section class="teams-content">
                <div class="dataTables_wrapper">
                    <div id="botones" style="padding: 15px;"> 
					    Mostrar/Ocultar Sección:  
				    </div>
                    <table id="mytable" class="display nowrap cell-border no-footer" style="width:100%;table-layout:auto; text-align: center;">
                        <thead>
                            <tr>
                                <th hidden rowspan="3" data-col_from="0" data-col_to="0">Correo</th>
                                <th  rowspan="3" data-col_from="1" data-col_to="1">Estudiante</th>
                                <% col_len = 2 %>
                                %for section in materia:
                                    %if materia[section]['total_hijos'] > 0:
                                        <th class="mainhead" colspan="${materia[section]['total_hijos']+1}" data-col_from="${col_len}" data-col_to="${col_len+materia[section]['total_hijos']}">${materia[section]['name_seccion']}</th>
                                        <% col_len = col_len + materia[section]['total_hijos'] +1 %>
                                    %endif
                                %endfor
                                <th rowspan="3" data-col_from="${col_len}" data-col_to="${col_len}">Total</th>
                                <th rowspan="3" data-col_from="${col_len+1}" data-col_to="${col_len+1}">Certificado Generado</th>
                            </tr>
                            <tr>
                                <% i = 1 %>
                                <% j = 1 %> 
                                <% pto_position = 1 %>
                                %for section in materia:
                                    <% j= 1 %>
                                    <% subsecciones = materia[section]['children_seccion'] %>
                                        %for sub in subsecciones.items():
                                            %if sub[1]['total_hijos'] > 0:
                                                <td colspan="${sub[1]['total_hijos']}" title="${sub[1]['name_sub']}"> ${i}.${j} </td>
                                            %endif
                                            <% j += 1 %>
                                        %endfor
                                        %if materia[section]['total_hijos'] > 0:
                                            <% pto_position = pto_position + materia[section]['total_hijos'] + 1 %>
                                            <td rowspan="2" class="pto" id="${pto_position}">Puntos</td>
                                        %endif
                                        
                                    <% i += 1 %>
                                %endfor:
                            </tr>
                            <tr>                            
                                <% i = 1 %>
                                <% j = 1 %>
                                <% k = 1 %>
                                %for section in materia:
                                    <% j= 1 %>
                                    <% subsecciones = materia[section]['children_seccion'] %>
                                        %for sub in subsecciones.items():
                                            <% k= 1 %>
                                            <% units = sub[1]['children_sub'] %>
                                                %for unit in units.items():
                                                    <td title="${unit[1]['name_uni']}">
                                                        ${i}.${j}.${k}
                                                    </td>
                                                    <% k += 1 %>
                                                %endfor
                                            <% j += 1 %>
                                        %endfor
                                    <% i += 1 %>
                                %endfor
                                
                            </tr>
                        </thead>
                        <tbody>
                            %for alumno in lista_alumnos:
                            <tr>
                                <td hidden>${alumno['email']}</td>
                                <td>${alumno['username']}</td>
                                <% sections =lista_tick[alumno['id']]['sec'] %>
                                <!-- for index in range(len(list)): -->
                                %for section in sections.items():
                                    <% subsection =section[1]['subs'] %>                               
                                        %for sub in subsection.items():
                                            <% units = sub[1]['unidades'] %>
                                                %for unit in units.items():
                                                <% aux_unit =unit[1] %>
                                                    <td title="${aux_unit[2]}">
                                                        %if aux_unit[1]:
                                                            &#10004;
                                                        %endif
                                                    </td>                                                
                                                %endfor
                                        %endfor
                                    %if section[1]['max'] > 0:
                                        <td>${section[1]['ptos'] } / ${section[1]['max'] }</td>
                                    %endif
                                %endfor
                                <td>${lista_tick[alumno['id']]['ptos']}/${max}</td>
                                <td>${lista_tick[alumno['id']]['certificado']}</td>
                            </tr>
                            %endfor
                            
                        </tbody>
                        
                    </table>
                </div>
            </section>
        </main>
    </div>
</div>
<script>
$(document).ready(function () {
    var main_header = $('.mainhead');
    var columns_pto = $('.pto');
    var array_index_column_pto = [0]
    for (j = 0; j < columns_pto.length; j++) {
        array_index_column_pto.push(parseInt(columns_pto[j].id))
    }
    array_index_column_pto.push(parseInt(columns_pto[columns_pto.length-1].id)+1)
    for (j = 0; j < main_header.length; j++) {
        var aux_i = main_header[j].dataset.col_from
        var aux_j = main_header[j].dataset.col_to
        $('#botones')[0].innerHTML = $('#botones')[0].innerHTML + ' - <a class="toggle-vis novisto" value="' + aux_i + ',' + aux_j + '">' + main_header[j].textContent + '</a>'
    }

    var myTable = $('#mytable').DataTable({
        "sScrollX": '100%',
        rowReorder: true,
        dom: 'Bfrtip',
        buttons: [
           'excelHtml5'
        ],
        columnDefs: [
            { orderable: true, className: 'reorder', targets: array_index_column_pto },
            { orderable: false, targets: '_all' }
        ],
        language: {
            "decimal": "",
            "emptyTable": "No hay información",
            "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
            "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
            "infoFiltered": "(Filtrado de _MAX_ total entradas)",
            "infoPostFix": "",
            "thousands": ",",
            "lengthMenu": "Mostrar _MENU_ Entradas",
            "loadingRecords": "Cargando...",
            "processing": "Procesando...",
            "search": "Buscar:",
            "zeroRecords": "Sin resultados encontrados",
            "paginate": {
                "first": "Primero",
                "last": "Ultimo",
                "next": "Siguiente",
                "previous": "Anterior"
            }
        }
    });

    $('a.toggle-vis').on('click', function (e) {
        e.preventDefault();
        // Get the column API object
        var minmax = $(this).attr('value');
        var aux = minmax.split(',')
        var min = parseInt(aux[0])
        var max = parseInt(aux[1])
        for (i = min; i <= max; i++) {
            var column = myTable.column(i);
            column.visible(!column.visible());
        }
        if ($(this).hasClass('visto')){
            $(this).removeClass('visto')
            $(this).addClass('novisto')
        }
        else{
            $(this).removeClass('novisto')
            $(this).addClass('visto')
        }
    });
    

});
</script>
